{
  "subject": "Worker 3 bootstrap",
  "description": "Coordinate on: CONTEXT PACK GENERATION (READ-ONLY AUDIT; NO CODE CHANGES)\n\nREPO SHAPE\n- vibetrading_v1/ = legacy system (source of truth for current behavior)\n- vibetrading_v2/ = target system (in-progress)\nGOAL\n- Produce a docs-only “context pack” that captures CURRENT REALITY: entrypoints, runtime flows, contracts/interfaces, and gaps—so a v2 master plan can be written without missing repo details.\n\nNON-NEGOTIABLE RULES\n1) WRITE SCOPE: You may ONLY create/modify files under: docs/context/*.md\n   - If any non-doc file changes for ANY reason:\n     a) Immediately REVERT: git checkout -- .\n     b) Report what changed and why (include `git status --porcelain` output).\n2) SAFETY:\n   - Do NOT run live orders. Do NOT require secrets. Do NOT print secrets.\n   - Do NOT add prompts that require API keys. Redact any accidental secret output immediately.\n3) ALLOWED COMMANDS (read-only / check-only):\n   - Inspection: ls, tree, fd, rg, cat, sed/head/tail, git grep, git show\n   - Python import checks: python -c \"import ...\"\n   - Tests discovery only: pytest --collect-only\n   - Linters/type check in check-only mode: ruff check, mypy (no auto-fix)\n   - Git status/diff: git status, git diff (for docs/context only)\n4) EVIDENCE STANDARD (no guessing):\n   - Every claim MUST cite concrete evidence: file paths + symbol names + (preferably) line ranges OR command output snippets.\n   - Use citations like: `path/to/file.py:123-156 (SymbolName)` or fenced command outputs.\n5) EACH MARKDOWN FILE must end with a section titled exactly: `## Evidence`\n   - Include:\n     - Commands run (exact commands)\n     - Key outputs/findings (short excerpts)\n     - At least 5 concrete references to repo files/symbols per file\n\nWORKER OWNERSHIP (NO OVERLAP)\n- Worker1: 00_repo_overview.md + 10_v1_system_map.md\n- Worker2: 20_v2_system_map.md + 30_gap_matrix.md\n- Worker3: 40_interfaces_and_schemas.md + 50_bar_semantics.md\n- Worker4: 60_order_and_safety_semantics.md + 70_test_and_verification_matrix.md + 80_risk_register.md\nRules:\n- Only edit the files you own.\n- You may READ anything in repo, but only WRITE your assigned markdown files.\n\nOUTPUT DIRECTORY\n- Ensure docs/context/ exists (create if missing).\n- Create EXACTLY these 9 files (no extras):\n  1) docs/context/00_repo_overview.md\n  2) docs/context/10_v1_system_map.md\n  3) docs/context/20_v2_system_map.md\n  4) docs/context/30_gap_matrix.md\n  5) docs/context/40_interfaces_and_schemas.md\n  6) docs/context/50_bar_semantics.md\n  7) docs/context/60_order_and_safety_semantics.md\n  8) docs/context/70_test_and_verification_matrix.md\n  9) docs/context/80_risk_register.md\n\nGLOBAL WORKFLOW (ALL WORKERS)\nA) Establish repo map:\n   - tree/ls at root and inside vibetrading_v1/ and vibetrading_v2/\n   - find entrypoints: pyproject scripts, __main__.py, cli modules, bin scripts\n   - find config/env usage: rg for os.environ, dotenv, config loaders, YAML/TOML/JSON\nB) Gather evidence BEFORE writing conclusions:\n   - For each section you write, collect at least 2-3 direct code references.\nC) Write your markdown file(s), then run:\n   - git diff -- docs/context\n   - Ensure your file ends with `## Evidence`\nD) NEVER run anything that could place orders; keep tests to collect-only.\n\nFILE REQUIREMENTS (STRICT)\n\n(00) docs/context/00_repo_overview.md  [Worker1]\nInclude:\n- Top-level tree summary (v1 vs v2): key packages/modules and likely entrypoints.\n- Discovered run paths: CLIs/scripts (python -m ..., console_scripts, entry modules), config files, referenced env vars.\n- Dependency/tooling: pyproject/requirements, linters/tests, how invoked.\n- CI config (GitHub Actions etc.) and current test invocation.\n\n(10) docs/context/10_v1_system_map.md  [Worker1]\nInclude:\n- Entry points: where v1 starts; major runtime loops/schedulers.\n- Data path: how v1 obtains OHLCV (or nearest equivalent), frequency, caching, persistence (DB/files), schemas.\n- Strategy path: signal generation modules, portfolio/position representation, risk constraints.\n- Execution path: order placement workflow, idempotency (if any), retries/rate-limits, error handling, kill-switches.\n- Coupling hotspots: circular imports, global state, shared mutable singletons, IO tightly coupled to logic.\n- Bullet list of key files/symbols (>=15) with one-line roles.\nAll claims must be backed by code refs.\n\n(20) docs/context/20_v2_system_map.md  [Worker2]\nInclude:\n- Current state: folder layout, existing modules, what matches ports/adapters, what violates boundaries.\n- For each existing v2 module: responsibilities + key classes/functions + dependencies.\n- What was intentionally excluded (data collection, DB) and current placeholders/stubs.\n- Bullet list of key files/symbols (>=15) with one-line roles.\n\n(30) docs/context/30_gap_matrix.md  [Worker2]\nProvide a table with columns:\nRequirement | Current Status | Evidence (file/symbol) | Gap | Proposed Fix (high-level) | Priority\nMust include rows for:\n- 1-min OHLCV only (no orderbook)\n- Parquet deterministic backtest harness\n- Paper broker with same order lifecycle shape as live\n- Live/paper safety gates (LIVE_API=1 & CONFIRM_LIVE=YES)\n- Engine split: RebalancingEngine vs SingleStrategyEngine (Arb stub only)\n- Bar semantics: timestamp meaning, timezone, bar-close rules, missing/dup/out-of-order handling\n- Order state machine + idempotency\n- Kill-switch policy\n- Adapter boundaries (core import bans)\n- Backtest report outputs (orders/positions/pnl/risk artifacts)\nEach row must cite evidence, even if status is “missing”.\n\n(40) docs/context/40_interfaces_and_schemas.md  [Worker3]\nInclude canonical schemas (fields + meaning + types):\n- Bar (1m OHLCV), Signal, TargetWeights, Order, Fill, PortfolioState, RiskState\nInclude canonical ports (Python Protocol/ABC signatures):\n- BarDataSource (historical + live), Broker (paper + live), Clock, StateStore\nMap each schema/port to existing code references (v1/v2) and call out mismatches.\nInclude: `## Compatibility Notes` for Kiwoom/KIS constraints discovered in code (if any). If none found, say so and cite your search (rg results).\n\n(50) docs/context/50_bar_semantics.md  [Worker3]\nDefine ONE canonical timestamp convention (recommend bar CLOSE time) and justify using repo evidence.\nSpecify:\n- Timezone policy, session boundary assumptions, holidays/weekends handling if present in code/config.\n- Deterministic rules:\n  - missing bars (explicit policy: skip/mark gap/fill and how)\n  - duplicate bars (dedup key + winner rule)\n  - out-of-order bars (buffer/sort/reject rule)\n- Testable invariants (monotonic ts, fixed 1m spacing, no duplicates, etc.)\n- Parquet storage spec (schema/columns) matching live semantics\nBack every “current behavior” statement with v1/v2 references; clearly label “proposed” vs “observed”.\n\n(60) docs/context/60_order_and_safety_semantics.md  [Worker4]\nDefine:\n- Broker-agnostic order lifecycle state machine: states + transitions + terminal states.\n- Idempotency strategy: key generation rules, storage, enforcement points (app vs adapter vs core).\n- Retry/rate-limit policy: which errors retry, backoff, max attempts, fail-fast conditions.\n- Kill-switch: triggers, actions (cancel/flatten/stop), enforcement location(s).\n- Live safety gates: exact env gates and exactly where enforced (apps layer + adapters).\n- Default behavior: paper unless gated.\nWherever possible, tie to existing patterns in v1 and current v2 direction; cite both.\n\n(70) docs/context/70_test_and_verification_matrix.md  [Worker4]\nInclude:\n- Deterministic backtest verification:\n  - how to run, artifact locations, hash/diff approach, tolerances (if any)\n  - required fixtures / example parquet layout\n- Unit tests by layer:\n  - core (strategy/engine/risk/order state machine)\n  - ports contract tests (fake adapters)\n  - adapter smoke tests (no live by default)\n- Live smoke tests:\n  - only under env gates, minimal safe ops (connect, fetch bars, paper/sandbox order if available, cancel)\n- CI recommendations:\n  - default job runs deterministic tests only\n  - separate manual/secured job for live smoke\nCite existing test structure/CI files; if missing, cite the absence (searched paths/patterns).\n\n(80) docs/context/80_risk_register.md  [Worker4]\nRisk register table:\nRisk | Severity | Likelihood | Detection | Mitigation | Owner (lane)\nMust include:\n- bar semantics mismatch\n- look-ahead/leakage\n- data gaps/dup/out-of-order\n- idempotency bugs\n- duplicate orders\n- rate-limit lockout\n- timezone bugs\n- partial fills handling\n- silent failures\n- config mistakes\n- dependency drift\n- unsafe live trading defaults\nTie each risk to at least one repo reference or explicit “not found” evidence.\n\nFINAL CHECKS (MANDATORY, DO NOT SKIP)\n1) Verify all 9 files exist (list them).\n2) Verify each file ends with `## Evidence`.\n3) Verify each file contains >=5 concrete repo references (paths/symbols/keys) and command evidence.\n4) Verify git status shows ONLY docs/context/* changes:\n   - Run: git status --porcelain\n   - Report the summary in the final response (include the output).\n\nReport findings/results back to the lead and keep task updates current.",
  "status": "completed",
  "owner": "worker-3",
  "id": "3",
  "depends_on": [],
  "version": 3,
  "created_at": "2026-02-23T07:47:07.989Z",
  "claim": {
    "owner": "worker-3",
    "token": "10e95843-fe52-4264-91e8-f5f635e2bcbb",
    "leased_until": "2026-02-23T08:02:49.053Z"
  },
  "result": "Completed Worker-3 deliverables: rewrote docs/context/40_interfaces_and_schemas.md and created docs/context/50_bar_semantics.md with canonical schemas/ports, observed-vs-proposed bar semantics, Kiwoom/KIS compatibility notes, and evidence sections. Ran checks for Evidence headings and reference density. Note: git status --porcelain shows pre-existing repo-wide non-doc changes (many D/?? outside docs/context), so workspace is not docs-only at repository level."
}